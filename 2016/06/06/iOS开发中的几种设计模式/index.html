<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iOS开发中的几种设计模式 | spike</title>
  <meta name="author" content="John Doe">
  
  <meta name="description" content="收录几种常见设计模式的使用方法">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="iOS开发中的几种设计模式"/>
  <meta property="og:site_name" content="spike"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <link rel="alternative" href="/atom.xml" title="spike" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

</head>

<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/">spike</a><span class="split"></span><span class="title">iOS开发中的几种设计模式</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2016-06-06</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  

  
	<div class="col-md-12">
	  

	  <!-- content -->
	  <blockquote>
<p>收录几种常见设计模式的使用方法</p>
</blockquote>
<a id="more"></a>
<h2 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">“单例模式”是我在iOS中最常使用的设计模式之一。单例模式不需要传递任何参数，就有效地解决了不同代码间的数据共享问题。单例类是一个非常重要的概念，因为它们表现出了一种十分有用的设计模式。单例类的应用贯穿于整个iOS的SDK中。例如，UIApplication类有一个方法叫sharedApplication，从任何地方调用这个方法，都将返回与当前正在运行的应用程序相关联的UIApplication实例。除了这个，NSNotificationCenter(消息中心) 、NSFileManager(文件管理) 、 NSUserDefaults(应用程序设置) 、NSURLCache(请求缓存)、NSHTTPCookieStorage(应用程序cookies池)都是系统单例；单例类保证了应用程序的生命周期中有且仅有一个该类的实例对象，而且易于外界访问。</span><br><span class="line">单例模式的要点：</span><br><span class="line">一是某个类只能有一个实例；二是它必须自行创建这个实例；三是它必须自行向整个系统提供这个实例。</span><br><span class="line">单例模式的优点：</span><br><span class="line">1.实例控制：Singleton 会阻止其他对象实例化其自己的 Singleton 对象的副本，从而确保所有对象都访问唯一实例。</span><br><span class="line">2.灵活性：因为类控制了实例化过程，所以类可以更加灵活修改实例化过程</span><br><span class="line">IOS中的单例模式：</span><br><span class="line">在objective-c中要实现一个单例类，至少需要做以下四个步骤：</span><br><span class="line">1、为单例对象实现一个静态实例，并初始化，然后设置成nil，</span><br><span class="line">2、实现一个实例构造方法检查上面声明的静态实例是否为nil，如果是则新建并返回一个本类的实例，</span><br><span class="line">3、重写allocWithZone方法，用来保证其他人直接使用alloc和init试图获得一个新实力的时候不产生一个新实例，</span><br><span class="line">4、适当实现copyWithZone，release和autorelease。</span><br><span class="line"></span><br><span class="line">单例模式的要点：</span><br><span class="line">一是某个类只能有一个实例；二是它必须自行创建这个实例；三是它必须自行向整个系统提供这个实例。</span><br><span class="line"></span><br><span class="line">下面这种写法是最常用的写法，这个是线程安全的。 </span><br><span class="line">dispach_once函数中的代码块只会被执行一次。+(SchoolManager *)sharedInstance  </span><br><span class="line">&#123;  </span><br><span class="line">    static SchoolManager *sharedManager;  </span><br><span class="line">      </span><br><span class="line">    static dispatch_once_t onceToken;  </span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;  </span><br><span class="line">        sharedManager = [[SchoolManager alloc] init];  </span><br><span class="line">    &#125;);  </span><br><span class="line">      </span><br><span class="line">    return sharedManager;  </span><br><span class="line">&#125;  </span><br><span class="line">获取实例：SchoolManager *schoolManager = [SchoolManager sharedInstance];  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===单例模式的实现：</span><br><span class="line">代码示例：</span><br><span class="line">MySingletonClass.h</span><br><span class="line"></span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">@interface MySingletonClass : NSObject//单例方法</span><br><span class="line">+(MySingletonClass *)sharedInstance;</span><br><span class="line">@end</span><br><span class="line">MySingletonClass.m</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">#import &quot;MySingletonClass.h&quot;</span><br><span class="line">@implementation MySingletonClass</span><br><span class="line">//1、为单例对象实现一个静态实例，并初始化，然后设置成nil，static MySingletonClass *manager = nil;</span><br><span class="line">//2、实现一个实例构造方法检查上面声明的静态实例是否为nil，如果是则新建并返回一个本类的实例，+(MySingletonClass *)sharedInstance&#123;        @synchronized(self) &#123;        if(manager == nil) &#123;            manager = [[MySingletonClass  alloc] init]; //   assignment   not   done   here        &#125;    &#125;    return manager;&#125;</span><br><span class="line">//3、重写allocWithZone方法，用来保证其他人直接使用alloc和init试图获得一个新实力的时候不产生一个新实例，+(id)allocWithZone:(NSZone *)zone&#123;    @synchronized(self)&#123;                if (!manager) &#123;                        manager = [super allocWithZone:zone]; //确保使用同一块内存地址                        return manager;                    &#125;                return nil;    &#125;&#125;</span><br><span class="line">//4、适当实现copyWithZone，release和autorelease。- (id)init;&#123;    @synchronized(self) &#123;                if (self = [super init])&#123;                        return self;        &#125;                return nil;    &#125;&#125;</span><br><span class="line">//确保copy对象也是唯一- (id)copyWithZone:(NSZone *)zone;&#123;        return self;    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="委托模式"><a href="#委托模式" class="headerlink" title="委托模式"></a>委托模式</h3><p>转载自 :<a href="http://www.samirchen.com/ios-delegate/" target="_blank" rel="external">这里</a></p>
<ul>
<li>介绍：delegation，委托模式，是简单的强大的模式，可让一个对象扮演另外对象的行为。委托对象保持到另外对象的引用，并在适当的时候发消息给另外对象。委托对象可以在发送消息的时候做一些额外的事情。<br>在cocoa框架中的委托模式，委托对象往往是框架中的对象，被委托对象是自定义的controller对象。委托对象保持一个到被委托对象的弱引用。是典型的回调。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">示例：</span><br><span class="line"></span><br><span class="line">2.1）代码：CPPropOperationView.h</span><br><span class="line"></span><br><span class="line">在这里定义了 CPPropOperationViewDelegate，它有两个 required 的方法 refreshPropOperationView: 和 closePropOperationView: ，所有实现这个 CPPropOperationViewDelegate 的类需要去实现这两个方法。</span><br><span class="line"></span><br><span class="line">接着，声明了 CPPropOperationView 这个类的一些属性，其中包括 id delegate。</span><br><span class="line"></span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"> </span><br><span class="line">#pragma mark - delegate</span><br><span class="line">@protocol CPPropOperationViewDelegate &lt;NSObject&gt;</span><br><span class="line">@required</span><br><span class="line">-(void) refreshPropOperationView:(id)sender;</span><br><span class="line">-(void) closePropOperationView:(id)sender; </span><br><span class="line">@end</span><br><span class="line"> </span><br><span class="line">#pragma mark - class</span><br><span class="line">@interface CPPropOperationView : UIView &#123;</span><br><span class="line">&#125;</span><br><span class="line">@property (nonatomic, assign) id&lt;CPPropOperationViewDelegate&gt; delegate;</span><br><span class="line">@property (nonatomic, retain) UIImageView* backgroundImageView;</span><br><span class="line">@property (nonatomic, retain) UIButton* refreshBtn;</span><br><span class="line">@property (nonatomic, retain) UIButton* closeBtn;</span><br><span class="line">@end</span><br><span class="line">2.2）代码：CPPropOperationView.m</span><br><span class="line"></span><br><span class="line">这里是对 CPPropOperationView 页面元素的一些实现代码。可以看到，我们在给 CPPropOperationView 的两个按钮 refreshBtn 和 closeBtn 绑定方法的时候，addTarget: 的对象是 delegate，这说明我们将用代理调用这些按钮对应的方法。</span><br><span class="line"></span><br><span class="line">#import &quot;CPPropOperationView.h&quot;</span><br><span class="line"> </span><br><span class="line">@implementation CPPropOperationView</span><br><span class="line">@synthesize delegate;</span><br><span class="line">@synthesize backgroundImageView = _backgroundImageView;</span><br><span class="line">@synthesize refreshBtn = _refreshBtn;</span><br><span class="line">@synthesize closeBtn = _closeBtn;</span><br><span class="line"> </span><br><span class="line">#pragma mark - View Life Cycle</span><br><span class="line">- (id)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        // Initialization code       </span><br><span class="line">        </span><br><span class="line">        // background image.</span><br><span class="line">        self.backgroundImageView = [[[UIImageView alloc] initWithImage:[UIImage imageNamed:@&quot;bg.png&quot;]] autorelease];</span><br><span class="line">        [self.backgroundImageView setFrame:CGRectMake(0, 0, frame.size.width, frame.size.height)];</span><br><span class="line">        [self addSubview:self.backgroundImageView];</span><br><span class="line">         </span><br><span class="line">        // Refresh button. Bind to delegate&apos;s refreshPropOperationView:.</span><br><span class="line">        self.refreshBtn = [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">        [self.refreshBtn setFrame:CGRectMake(0, 0, 225, 45)];</span><br><span class="line">        [self.refreshBtn setTitle:@&quot;Refresh 0&quot; forState:UIControlStateNormal];</span><br><span class="line">        [self.refreshBtn addTarget:delegate action:@selector(refreshPropOperationView:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">        [self addSubview:self.refreshBtn];</span><br><span class="line">        </span><br><span class="line">        // Prop close button. Bind to delegate&apos;s closePropOperationView:.</span><br><span class="line">        self.closeBtn = [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">        [self.closeBtn setFrame:CGRectMake(0, 100, 45, 45)];</span><br><span class="line">        [self.closeBtn setImage:[UIImage imageNamed:@&quot;close.png&quot;] forState:UIControlStateNormal];</span><br><span class="line">        [self.closeBtn addTarget:delegate action:@selector(closePropOperationView:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">        [self addSubview:self.closeBtn];</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">-(void) dealloc &#123;</span><br><span class="line">    [_backgroundImageView release];</span><br><span class="line">    [_refreshBtn release];</span><br><span class="line">    [_closeBtn release];</span><br><span class="line">    </span><br><span class="line">    [super dealloc];</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">@end</span><br><span class="line">2.3）代码：StoreViewCtrler.h StoreViewCtrler 拥有 CPPropOperationView 的实例，并实现 CPPropOperationViewDelegate。</span><br><span class="line"></span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">#import &quot;CPPropOperationView.h&quot;</span><br><span class="line"> </span><br><span class="line">@interface StoreViewCtrler : UIViewController &lt;CPPropOperationViewDelegate&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line">@property (nonatomic, retain) CPPropOperationView* propOperationView;</span><br><span class="line">@end</span><br><span class="line">2.4）代码：StoreViewCtrler.m</span><br><span class="line"></span><br><span class="line">在这里，实现了 CPPropOperationViewDelegate 的 refreshPropOperationView: 和 closePropOperationView: 这两个方法。并通过 self.propOperationView.delegate = self; 将代理设为自己。那么点击 self.propOperationView 的 refreshBtn 和 closeBtn 将分别调用这里实现的 refreshPropOperationView: 和 closePropOperationView: 这两个方法。</span><br><span class="line"></span><br><span class="line">#import &quot;StoreViewCtrler.h&quot;</span><br><span class="line">#import &quot;CPPropOperationView.h&quot;</span><br><span class="line"> </span><br><span class="line">@implementation StoreViewCtrler</span><br><span class="line">@synthesize magiboxOperationView;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">#pragma mark - CPPropOperationViewDelegate </span><br><span class="line">-(void) refreshPropOperationView:(id)sender &#123; </span><br><span class="line">     self.backgroundImageView.image = [UIImage imageNamed:@&quot;bg2.png&quot;];</span><br><span class="line">     [self.propOperationView.refreshBtn setTitle:[NSString stringWithFormat:@&quot;Refresh 1&quot;] forState:UIControlStateNormal]; </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">-(void) closePropOperationView:(id)sender &#123;</span><br><span class="line">     self.propOperationView.hidden = YES;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">#pragma mark - View lifecycle </span><br><span class="line">-(void) viewWillAppear:(BOOL)animated &#123;</span><br><span class="line">    [super viewWillAppear:animated];</span><br><span class="line">     </span><br><span class="line">    if (self.propOperationView == nil) &#123;</span><br><span class="line">        self.propOperationView = [[[CPPropOperationView alloc] initWithFrame:CGRectMake(0, 0, 300, 300)] autorelease];</span><br><span class="line">        self.propOperationView.delegate = self;</span><br><span class="line">        [self.view addSubview:self.propOperationView];</span><br><span class="line">    &#125;</span><br><span class="line">    self.propOperationView.hidden = NO;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">- (void)viewDidUnload &#123;</span><br><span class="line">    [super viewDidUnload];</span><br><span class="line">    </span><br><span class="line">    // Release any retained subviews of the main view.</span><br><span class="line">    self.magiboxOperationView = nil;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">-(void) dealloc &#123;</span><br><span class="line">    [magiboxOperationView release];</span><br><span class="line">    </span><br><span class="line">    [super dealloc];</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
	
		
	
		
			
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
			
		
	
		
			
			
		
	
		
	
		
	
		
	
		
	
		
			
			
			
		
			
		
	
	
	
		<li class="prev"><a href="/2016/06/06/iOS页面流/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/2016/05/24/Mac下搭建hexo博客/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  &copy; 2016 John Doe
  
      with help from <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-wixo/">Wixo</a>.    
</p> </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tableofcontents.min.js"></script>
<script src="/js/tocgenerator.min.js"></script>
<script src="/js/main.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>

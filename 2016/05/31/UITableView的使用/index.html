<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>UITableView的使用 | spike 代码之美</title>
  <meta name="author" content="John Doe">
  
  <meta name="description" content="概述
UITableView继承自UIScrollView，基本配置主要是通过两个协议，UITableViewDataSource（提供显示用的数据）和UITableViewDelegate（用来控制tableview的选择section的头和尾的显示），有两种风格Plain和Grouped。UIT">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="UITableView的使用"/>
  <meta property="og:site_name" content="spike 代码之美"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <link rel="alternative" href="/atom.xml" title="spike 代码之美" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  

</head>

<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/">spike 代码之美</a><span class="split"></span><span class="title">UITableView的使用</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2016-05-31</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  

  
	<div class="col-md-12">
	  

	  <!-- content -->
	  <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><blockquote>
<p>UITableView继承自UIScrollView，基本配置主要是通过两个协议，UITableViewDataSource（提供显示用的数据）和UITableViewDelegate（用来控制tableview的选择section的头和尾的显示），有两种风格Plain和Grouped。UITableView中显示的每一个单元都是一个UITableViewCell对象在tableView快速滑动的滑动的过程中，频繁的alloc对象是比较费时的，于是引入了cell的重用机制。简单的理解就是：UITableView只会创建一屏幕（或一屏幕多一点）的UITableViewCell，其他都是从中取出来重用的。每当Cell滑出屏幕时，就会放入到一个集合（或数组）中（这里就相当于一个重用池），当要显示某一位置的Cell时，会先去集合（或数组）中取，如果有，就直接拿来显示；如果没有，才会创建。这样做的好处可想而知，极大的减少了内存的开销。另外还有几点：<br>1、UITableView需要一个数据源(dataSource)来显示数据<br>2、UITableView会向数据源查询一共有多少行数据以及每一行显示什么数据等<br>3、没有设置数据源的UITableView只是个空壳<br>4、凡是遵守UITableViewDataSource协议的OC对象，都可以是UITableView的数据源</p>
</blockquote>
<h2 id="UITableViewCell"><a href="#UITableViewCell" class="headerlink" title="UITableViewCell"></a>UITableViewCell</h2><h5 id="cell的重用原理"><a href="#cell的重用原理" class="headerlink" title="cell的重用原理"></a>cell的重用原理</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">重用原理：当滚动列表时，部分UITableViewCell会移出窗口，UITableView会将窗口外的UITableViewCell放入一个缓存池中，等待重用。当UITableView要求dataSource返回UITableViewCell时，dataSource会先查看这个缓存池，如果池中有未使用的UITableViewCell，dataSource会用新的数据配置这个UITableViewCell，然后返回给UITableView，重新显示到窗口中，从而避免创建新对象。</span><br><span class="line"></span><br><span class="line">还有一个非常重要的问题：有时候需要自定义UITableViewCell(用一个子类继承UITableViewCell)，而且每一行用的不一定是同一种UITableViewCell，所以一个UITableView可能拥有不同类型的UITableViewCell，缓存池中也会有很多不同类型的UITableViewCell，那么UITableView在重用UITableViewCell时可能会得到错误类型的UITableViewCell。</span><br><span class="line"></span><br><span class="line">解决方案：UITableViewCell有个NSString *reuseIdentifier属性，可以在初始化UITableViewCell的时候传入一个特定的字符串标识来设置reuseIdentifier(一般用UITableViewCell的类名)。当UITableView要求dataSource返回UITableViewCell时，先通过一个字符串标识到缓存池中查找对应类型的UITableViewCell对象，如果有，就重用，如果没有，就传入这个字符串标识来初始化一个UITableViewCell对象。</span><br></pre></td></tr></table></figure>
<h2 id="UITableViewDataSource中的常用方法"><a href="#UITableViewDataSource中的常用方法" class="headerlink" title="UITableViewDataSource中的常用方法"></a>UITableViewDataSource中的常用方法</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// 必须实现的方法：</span><br><span class="line">/* 设置第section组有多少行数据 */</span><br><span class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section;</span><br><span class="line">/* 设置每一行cell的内容，每当有一个cell进入视野屏幕的时候就会调用这个方法，所以在这个方法内部进行优化（cell的复用） */</span><br><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath;</span><br><span class="line"></span><br><span class="line">// 可实现可不实现的方法：</span><br><span class="line">/* 总共有多少组，如果不实现，默认是一组 */</span><br><span class="line">- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView;</span><br><span class="line"></span><br><span class="line">/* 第section组的头部标题 */</span><br><span class="line">- (nullable NSString *)tableView:(UITableView *)tableView titleForHeaderInSection:(NSInteger)section;</span><br><span class="line"></span><br><span class="line">/* 第section组的尾部标题 */</span><br><span class="line">- (nullable NSString *)tableView:(UITableView *)tableView titleForFooterInSection:(NSInteger)section;</span><br><span class="line"></span><br><span class="line">/** 设置索引条 */</span><br><span class="line">- (nullable NSArray&lt;NSString *&gt; *)sectionIndexTitlesForTableView:(UITableView *)tableView;</span><br></pre></td></tr></table></figure>
<h2 id="UITableViewDelegate中的常用方法"><a href="#UITableViewDelegate中的常用方法" class="headerlink" title="UITableViewDelegate中的常用方法"></a>UITableViewDelegate中的常用方法</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 设置每一行cell的高度 */</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 设置第section组的头部高度 */</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForHeaderInSection:(<span class="built_in">NSInteger</span>)section;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 设置第section组的尾部高度 */</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForFooterInSection:(<span class="built_in">NSInteger</span>)section;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 每一行的估算高度 */</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView estimatedHeightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 设置第section组的headerView */</span></span><br><span class="line">- (nullable <span class="built_in">UIView</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView viewForHeaderInSection:(<span class="built_in">NSInteger</span>)section;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 设置第section组的footerView */</span></span><br><span class="line">- (nullable <span class="built_in">UIView</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView viewForFooterInSection:(<span class="built_in">NSInteger</span>)section;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 选中了某一行cell的时候就会调用这个方法 */</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置左滑删除按钮的文字</span><br><span class="line"> *  @param tableView         被编辑的tableView</span><br><span class="line"> *  @param indexPath         indexPath</span><br><span class="line"> *  @return 返回删除按钮显示的文字</span><br><span class="line"> */</span></span><br><span class="line">- (nullable <span class="built_in">NSString</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView titleForDeleteConfirmationButtonForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建一个左滑出现按钮的操作（UITableViewRowAction）数组</span><br><span class="line"> *  @param tableView         添加操作的tableView</span><br><span class="line"> *  @param indexPath         indexPath，可以指定每一行有不同的效果</span><br><span class="line"> *  @return 返回一个操作（UITableViewRowAction）数组</span><br><span class="line"> */</span></span><br><span class="line">- (nullable <span class="built_in">NSArray</span>&lt;<span class="built_in">UITableViewRowAction</span> *&gt; *)tableView:(<span class="built_in">UITableView</span> *)tableView editActionsForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  移动cell</span><br><span class="line"> *  @param tableView            操作的tableView</span><br><span class="line"> *  @param sourceIndexPath      移动的行</span><br><span class="line"> *  @param destinationIndexPath 目标行</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView moveRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)sourceIndexPath toIndexPath:(<span class="built_in">NSIndexPath</span> *)destinationIndexPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 根据editingStyle处理是删除还是添加操作，完成删除、插入操作刷新表格 */</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView commitEditingStyle:(<span class="built_in">UITableViewCellEditingStyle</span>)editingStyle forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置表格编辑模式，不实现默认都是删除</span><br><span class="line"> *  @param tableView 操作的tableView</span><br><span class="line"> *  @param indexPath cell的位置</span><br><span class="line"> *  @return 返回表格编辑样式</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">UITableViewCellEditingStyle</span>)tableView:(<span class="built_in">UITableView</span> *)tableView editingStyleForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br></pre></td></tr></table></figure>
<h2 id="tableView展示数据的过程"><a href="#tableView展示数据的过程" class="headerlink" title="tableView展示数据的过程"></a>tableView展示数据的过程</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UITableViewDataSource</span>,<span class="title">UITableViewDelegate</span>&gt;</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITableView</span> *tableView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.tableView.dataSource = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UITableViewDataSource</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView&#123;</span><br><span class="line">    <span class="comment">// 在这个方法中设置总共有多少组数据</span></span><br><span class="line">    <span class="comment">// 这个方法如果不实现，默认是一组</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section&#123;</span><br><span class="line">    <span class="comment">// 在这个方法中设置第section组有多行数据</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</span><br><span class="line">    <span class="comment">// 1.定义一个cell的复用标识</span></span><br><span class="line">      <span class="keyword">static</span> <span class="built_in">NSString</span> *ID = <span class="string">@"cell"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.根据复用标识，从缓存池中取出带有同样的复用标识的cell</span></span><br><span class="line">      <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:ID];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.如果缓存池中没有带有这种复用标识的cell，就创建一个带有这种复用标识的cell</span></span><br><span class="line">      <span class="keyword">if</span> (cell == <span class="literal">nil</span>) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:ID];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.设置cell的一些属性</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView titleForFooterInSection:(<span class="built_in">NSInteger</span>)section&#123;</span><br><span class="line">    <span class="comment">// 在这个方法中设置第section组的尾部标题</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView titleForHeaderInSection:(<span class="built_in">NSInteger</span>)section&#123;</span><br><span class="line">    <span class="comment">// 在这个方法中设置第section组的头部标题</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UITableViewDelegate</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</span><br><span class="line">    <span class="comment">// 当选中了某一行的时候就会调用这个方法，可以在这里进行一些操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">更改Cell的背景</span><br><span class="line"><span class="built_in">UIView</span> *myview = [[<span class="built_in">UIView</span> alloc] init]; </span><br><span class="line">myview.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">47</span>); </span><br><span class="line">myview.backgroundColor = [<span class="built_in">UIColorcolorWithPatternImage</span>:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"0006.png"</span>]]; </span><br><span class="line">cell.selectedBackgroundView = myview;</span><br><span class="line"></span><br><span class="line">更改Cell的标题</span><br><span class="line">cell.backgroundColor = [<span class="built_in">UIColorscrollViewTexturedBackgroundColor</span>]; </span><br><span class="line"><span class="comment">// 设置文字的字体  </span></span><br><span class="line">cell.textLabel.font = [<span class="built_in">UIFont</span> fontWithName:<span class="string">@"AmericanTypewriter"</span> size:<span class="number">100.0</span>f]; </span><br><span class="line"><span class="comment">// 设置文字的颜色  </span></span><br><span class="line">cell.textLabel.textColor = [<span class="built_in">UIColor</span> orangeColor]; </span><br><span class="line"><span class="comment">// 设置文字的背景颜色  </span></span><br><span class="line">cell.textLabel.shadowColor = [<span class="built_in">UIColor</span> whiteColor]; </span><br><span class="line"><span class="comment">// 设置文字的显示位置  </span></span><br><span class="line">cell.textLabel.textAlignment = <span class="built_in">UITextAlignmentCenter</span>; </span><br><span class="line"></span><br><span class="line">默认选中某一行</span><br><span class="line"><span class="built_in">NSIndexPath</span> *ip=[<span class="built_in">NSIndexPath</span> indexPathForRow:<span class="number">0</span> inSection:<span class="number">2</span>];  </span><br><span class="line">[tableView selectRowAtIndexPath:ip animated:<span class="literal">YES</span> scrollPosition:<span class="built_in">UITableViewScrollPositionBottom</span>];  </span><br><span class="line"></span><br><span class="line"><span class="built_in">NSIndexPath</span> *path=[<span class="built_in">NSIndexPath</span> indexPathForItem:<span class="number">0</span> inSection:<span class="number">2</span>];  </span><br><span class="line">[<span class="keyword">self</span> tableView:tableView didSelectRowAtIndexPath:path];  </span><br><span class="line"></span><br><span class="line">手绘分割线：</span><br><span class="line"> <span class="keyword">if</span>(indexPath.row&gt;<span class="number">0</span> &amp;&amp; indexPath.row&lt;=[<span class="keyword">self</span>.basicData count])&#123;</span><br><span class="line">        <span class="keyword">self</span>.tableView.separatorStyle=<span class="built_in">UITableViewCellSeparatorStyleNone</span>;</span><br><span class="line">        <span class="built_in">UIView</span>* separatorLineView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">0.5</span>)];<span class="comment">/// change size as you need.</span></span><br><span class="line">        separatorLineView.backgroundColor = [<span class="built_in">UIColor</span> grayColor];<span class="comment">// you can also put image here</span></span><br><span class="line">        [cell.contentView addSubview:separatorLineView];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">删除之前选中的行：</span><br><span class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">	[<span class="keyword">super</span> viewWillAppear:animated];</span><br><span class="line">	<span class="comment">// this UIViewController is about to re-appear, make sure we remove the current selection in our table view</span></span><br><span class="line">	<span class="built_in">NSIndexPath</span> *tableSelection = [<span class="keyword">self</span>.tableView indexPathForSelectedRow];</span><br><span class="line">	[<span class="keyword">self</span>.tableView deselectRowAtIndexPath:tableSelection animated:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">多选：</span><br><span class="line">uitableview本身就提供多选功能，选中的状态的管理不需要自己再维护。允许uitableivew多选设置一个属性就可以了,这时]:</span><br><span class="line"><span class="keyword">self</span>.tableView.allowsMultipleSelectionDuringEditing=<span class="literal">YES</span>;</span><br><span class="line">[<span class="keyword">self</span>.tableView setEditing:<span class="literal">YES</span>]; <span class="comment">//////设置uitableview为编译状态</span></span><br><span class="line"><span class="comment">//同时还有一个属性保存了你当前选择的indexPath集合</span></span><br><span class="line"><span class="built_in">NSArray</span> *indexPaths =[<span class="keyword">self</span>.tableView indexPathsForSelectedRows];</span><br><span class="line"></span><br><span class="line">重新设置uitableView的大小：</span><br><span class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated&#123;    [<span class="keyword">self</span>.tableView setFrame:<span class="built_in">CGRectMake</span>(x, y, w, h)];&#125;</span><br><span class="line"></span><br><span class="line">隐藏多余的分割线:</span><br><span class="line"><span class="keyword">self</span>.tableView.tableFooterView=[[<span class="built_in">UIView</span> alloc] init]; <span class="comment">// hide line</span></span><br><span class="line"></span><br><span class="line">动态添加行：</span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;  </span><br><span class="line">        <span class="keyword">self</span>.dataSourceArray= a new Array.  </span><br><span class="line">        [<span class="keyword">self</span>.tableView reloadData];  </span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line">在一个<span class="built_in">UIview</span>中添加<span class="built_in">UItableview</span>：</span><br><span class="line">TODOTableViewController  *todo = [[TODOTableViewController alloc] init];</span><br><span class="line">    todo.view.autoresizingMask = <span class="built_in">UIViewAutoresizingNone</span>;</span><br><span class="line">    [<span class="keyword">self</span> addChildViewController:todo];</span><br><span class="line">    todo.view.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">200</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="keyword">self</span>.view.bounds.size.height);</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:todo.view];</span><br><span class="line">    [todo didMoveToParentViewController:<span class="keyword">self</span>];</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">点击行不变色：</span><br><span class="line">    cell.selectionStyle = <span class="built_in">UITableViewCellSelectionStyleNone</span>;</span><br><span class="line">         </span><br><span class="line"><span class="built_in">UITableView</span>  reloaddata:</span><br><span class="line"></span><br><span class="line">RIGHT WAY: </span><br><span class="line">Principle:  Always change dataSource <span class="keyword">in</span> MAIN thread and call the reloadData immediately after it. </span><br><span class="line">Option <span class="number">1</span>: If the operation to change the dataSource should be executed <span class="keyword">in</span> background, the operation can create a temp dataSource array and pass it to main thread with notification, the main thread observes the notification,  <span class="keyword">assign</span> the tmpDataSource to dataSource and reload the tableView by reloadData.</span><br><span class="line"></span><br><span class="line">Option <span class="number">2</span>: In the background, call the GDC <span class="built_in">dispatch_async</span> to send the two methods to main thread together.</span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="keyword">self</span>.dataSourceArray= a new Array.<span class="comment">//   或删除当前列表的内容，从新加载[self.dataarray   removeAllObjects];</span></span><br><span class="line">             [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">设置搜索框:</span><br><span class="line">[_tableView setTableHeaderView:_searchBar];要记住在headerView中设置，否则会发生遮挡</span><br><span class="line"></span><br><span class="line"><span class="built_in">UItableview</span>异步加载数据：</span><br><span class="line">用AFNetworking为TableView异步加载数据</span><br><span class="line">为了让APP有更好的用户体验，所以是不能阻塞主线程的，而RSS的获取和解析都需要一定的时间，所以需要异步地来处理这些工作，配上MBProgressHUD效果更好。</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">auditTableViewController</span> ()&lt;<span class="title">MBProgressHUDDelegate</span>&gt;</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSMutableArray</span> *bianHao;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSMutableArray</span> *fakeData;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSMutableArray</span> *userIdData;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSMutableArray</span> *dataing;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSMutableArray</span> *time;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSMutableArray</span> *uid;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSMutableArray</span> *searchResultsData;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSMutableDictionary</span> *uAuditId;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) MBProgressHUD  *progress;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>) <span class="built_in">NSInteger</span> index;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">auditTableViewController</span></span></span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>) getDataAsy:(<span class="built_in">NSString</span> *)page &#123;</span><br><span class="line">    <span class="keyword">self</span>.progress=[[MBProgressHUD alloc] initWithView:<span class="keyword">self</span>.view];</span><br><span class="line">    <span class="keyword">self</span>.progress.progress=<span class="number">0.4</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.progress];</span><br><span class="line">    <span class="keyword">self</span>.progress.dimBackground=<span class="literal">NO</span>;</span><br><span class="line">    <span class="keyword">self</span>.progress.labelText=<span class="string">@"加载中，请稍后"</span>;</span><br><span class="line">    [<span class="keyword">self</span>.progress show:<span class="literal">YES</span>];</span><br><span class="line">    AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</span><br><span class="line">    manager.requestSerializer = [AFHTTPRequestSerializer serializer];</span><br><span class="line">    manager.responseSerializer = [AFHTTPResponseSerializer serializer];</span><br><span class="line">    <span class="built_in">NSString</span> *sid = [[APPDELEGATE.sessionInfo objectForKey:<span class="string">@"obj"</span>]objectForKey:<span class="string">@"sid"</span>];</span><br><span class="line">    <span class="built_in">NSDictionary</span> *parameters = @&#123;<span class="string">@"MOBILE_SID"</span>:sid,</span><br><span class="line">                                 <span class="string">@"page"</span>:page&#125;;</span><br><span class="line">    [manager POST:[SERVER_URL stringByAppendingString:<span class="string">@"mJobSubmissionAction!renWuJBXXSHDatagrid.action?"</span>] parameters:parameters success:^(AFHTTPRequestOperation *operation, <span class="keyword">id</span> responseObject) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *result =  [[<span class="built_in">NSString</span> alloc]initWithData:responseObject encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        [<span class="keyword">self</span> removeUnescapedCharacter:result];</span><br><span class="line">        <span class="built_in">NSDictionary</span> *rececive = [<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:[[<span class="keyword">self</span> removeUnescapedCharacter:result] dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>] options:<span class="built_in">NSJSONReadingMutableContainers</span> error:<span class="literal">nil</span>];</span><br><span class="line">        <span class="keyword">if</span>([[rececive objectForKey:<span class="string">@"success"</span>] boolValue] == <span class="literal">YES</span>)&#123;</span><br><span class="line">            <span class="built_in">NSArray</span> *list = [rececive objectForKey:<span class="string">@"obj"</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;[list count];i++) &#123;</span><br><span class="line">                <span class="built_in">NSDictionary</span> *listdic = [list objectAtIndex:i];</span><br><span class="line">                [<span class="keyword">self</span>.uid addObject:listdic];</span><br><span class="line">                <span class="built_in">NSString</span> *bianHao  = (<span class="built_in">NSString</span> *)[listdic objectForKey:<span class="string">@"bianHao"</span>];</span><br><span class="line">                <span class="built_in">NSString</span> *teamname = (<span class="built_in">NSString</span> *)[listdic objectForKey:<span class="string">@"qiYeMC"</span>];</span><br><span class="line">                <span class="built_in">NSString</span> *userId   = (<span class="built_in">NSString</span> *)[listdic objectForKey:<span class="string">@"yeWuZLMC_cn"</span>];</span><br><span class="line">                <span class="built_in">NSString</span> *time     = (<span class="built_in">NSString</span> *)[listdic objectForKey:<span class="string">@"renWuTJSJStr"</span>];</span><br><span class="line">                [<span class="keyword">self</span>.fakeData  addObject:teamname];</span><br><span class="line">                [<span class="keyword">self</span>.time      addObject:time];</span><br><span class="line">                [<span class="keyword">self</span>.dataing   addObject:userId];</span><br><span class="line">                [<span class="keyword">self</span>.bianHao   addObject:bianHao];</span><br><span class="line">            &#125;</span><br><span class="line">            dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">0.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">                [<span class="keyword">self</span>.progress hide:<span class="literal">YES</span>];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             [<span class="keyword">self</span>.progress hide:<span class="literal">YES</span>];</span><br><span class="line">            <span class="built_in">UIAlertView</span> *alert = [[<span class="built_in">UIAlertView</span> alloc]initWithTitle:<span class="string">@"网络连接超时"</span> message:<span class="string">@"请检查网络，重新加载!"</span> delegate:<span class="keyword">self</span> cancelButtonTitle:<span class="string">@"OK"</span> otherButtonTitles: <span class="literal">nil</span>,<span class="literal">nil</span>];</span><br><span class="line">            [alert show];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; failure:^(AFHTTPRequestOperation *operation, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">        </span><br><span class="line">         [<span class="keyword">self</span>.progress hide:<span class="literal">YES</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,error);</span><br><span class="line">        <span class="built_in">UIAlertView</span> *alert = [[<span class="built_in">UIAlertView</span> alloc]initWithTitle:<span class="string">@"请求错误"</span> message:<span class="string">@"请检查网络，重新加载!"</span> delegate:<span class="keyword">self</span> cancelButtonTitle:<span class="string">@"OK"</span> otherButtonTitles: <span class="literal">nil</span>,<span class="literal">nil</span>];</span><br><span class="line">        [alert show];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)fakeData</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_fakeData) &#123;</span><br><span class="line">        <span class="keyword">self</span>.bianHao=[[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">        <span class="keyword">self</span>.fakeData=[[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">        <span class="keyword">self</span>.dataing=[[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">        <span class="keyword">self</span>.time=[[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">        <span class="keyword">self</span>.uid=[[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">        [<span class="keyword">self</span> getDataAsy:<span class="string">@"1"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _fakeData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated&#123;</span><br><span class="line">    <span class="keyword">if</span>([APPDELEGATE.paramForaudit isEqualToString:<span class="string">@"fromAuditDetail"</span>])&#123;</span><br><span class="line">        APPDELEGATE.paramForaudit=<span class="string">@""</span>;<span class="comment">//控制刷新，通过字段限定不是每个页面跳转回来都刷新页面</span></span><br><span class="line">        [<span class="keyword">self</span>.fakeData removeAllObjects];</span><br><span class="line">        [<span class="keyword">self</span>.bianHao  removeAllObjects];</span><br><span class="line">        [<span class="keyword">self</span>.dataing  removeAllObjects];</span><br><span class="line">        [<span class="keyword">self</span>.time     removeAllObjects];</span><br><span class="line">        [<span class="keyword">self</span>.uid      removeAllObjects];</span><br><span class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(),^&#123;</span><br><span class="line">            [<span class="keyword">self</span> getDataAsy:<span class="string">@"1"</span>];</span><br><span class="line">            [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">同上：</span><br><span class="line">- (<span class="keyword">void</span>)loadFeed &#123;  AFHTTPRequestOperationManager *manager =      [AFHTTPRequestOperationManager manager];</span><br><span class="line">AFHTTPResponseSerializer *responseSerializer =      [AFHTTPResponseSerializer serializer];</span><br><span class="line">responseSerializer.acceptableContentTypes =      [<span class="built_in">NSSet</span> setWithObjects:<span class="string">@"application/atom+xml"</span>, <span class="literal">nil</span>];  manager.responseSerializer = responseSerializer;</span><br><span class="line">[manager GET:URL parameters:<span class="literal">nil</span>         success:^(AFHTTPRequestOperation *operation, <span class="keyword">id</span> responseObject)&#123;      <span class="built_in">NSData</span> *response = (<span class="built_in">NSData</span> *)responseObject;      Feed *feed = [FeedParser parse:response];      <span class="keyword">self</span>.feed = feed;</span><br><span class="line">     [<span class="keyword">self</span>.tableView reloadData];    &#125;failure:  ^(AFHTTPRequestOperation * operation, <span class="built_in">NSError</span> * error) &#123;    <span class="built_in">NSLog</span>(<span class="string">@"error: , %@"</span>, error);  &#125;];&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;  [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"><span class="comment">// Uncomment the following line to preserve selection between presentations.</span>  <span class="comment">// self.clearsSelectionOnViewWillAppear = NO;</span></span><br><span class="line"><span class="comment">// Uncomment the following line to display an Edit button in the navigation</span>  <span class="comment">// bar for this view controller.</span>  <span class="comment">// self.navigationItem.rightBarButtonItem = self.editButtonItem;</span></span><br><span class="line">[<span class="keyword">self</span> loadFeed];&#125;</span><br><span class="line"></span><br><span class="line">另外一种不阻塞主线程的方式:</span><br><span class="line">-(<span class="keyword">void</span>)getDataForActivity&#123;</span><br><span class="line">    AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</span><br><span class="line">    <span class="built_in">NSString</span> *sid = [[APPDELEGATE.sessionInfo objectForKey:<span class="string">@"obj"</span>]objectForKey:<span class="string">@"sid"</span>];</span><br><span class="line">    <span class="built_in">NSDictionary</span> *parameters = @&#123;<span class="string">@"MOBILE_SID"</span>:sid,</span><br><span class="line">                                 <span class="string">@"order"</span>:<span class="string">@"desc"</span>,</span><br><span class="line">                                 <span class="string">@"sort"</span> :<span class="string">@"time"</span>&#125;;</span><br><span class="line">    [manager POST:[SERVER_URL stringByAppendingString:<span class="string">@"mcustomerCallRecordsAction!mDatagrid1.action?"</span>] parameters:parameters success:^(AFHTTPRequestOperation *operation, <span class="keyword">id</span> responseObject) &#123;</span><br><span class="line">        <span class="keyword">if</span>([[responseObject objectForKey:<span class="string">@"success"</span>] boolValue] == <span class="literal">YES</span>)&#123;</span><br><span class="line">            <span class="built_in">NSArray</span> *list = [responseObject objectForKey:<span class="string">@"obj"</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;[list count];i++) &#123;</span><br><span class="line">                <span class="built_in">NSDictionary</span> *listDic =[list objectAtIndex:i];</span><br><span class="line">                <span class="built_in">NSString</span> *time = (<span class="built_in">NSString</span> *)[listDic objectForKey:<span class="string">@"timeStr"</span>];</span><br><span class="line">                <span class="keyword">if</span>([time isEqualToString:<span class="keyword">self</span>.date1])&#123;</span><br><span class="line">                    <span class="keyword">self</span>.acitvityIndex1++;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>([time isEqualToString:<span class="keyword">self</span>.date2])&#123;</span><br><span class="line">                    <span class="keyword">self</span>.acitvityIndex2++;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>([time isEqualToString:<span class="keyword">self</span>.date3])&#123;</span><br><span class="line">                    <span class="keyword">self</span>.acitvityIndex3++;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>([time isEqualToString:<span class="keyword">self</span>.date4])&#123;</span><br><span class="line">                    <span class="keyword">self</span>.acitvityIndex4++;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>([time isEqualToString:<span class="keyword">self</span>.date5])&#123;</span><br><span class="line">                    <span class="keyword">self</span>.acitvityIndex5++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">NSString</span> *data= [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d"</span>,<span class="keyword">self</span>.acitvityIndex1];</span><br><span class="line">            [<span class="keyword">self</span> performSelectorOnMainThread:<span class="keyword">@selector</span>(setUpActivityUI) withObject:data waitUntilDone:<span class="literal">YES</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            [<span class="keyword">self</span> setUpActivityUI];</span><br><span class="line">            <span class="built_in">UIAlertView</span> *alert = [[<span class="built_in">UIAlertView</span> alloc]initWithTitle:<span class="string">@"网络连接超时"</span> message:<span class="string">@"请检查网络，重新加载!"</span> delegate:<span class="keyword">self</span> cancelButtonTitle:<span class="string">@"OK"</span> otherButtonTitles: <span class="literal">nil</span>,<span class="literal">nil</span>];</span><br><span class="line">            [alert show];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; failure:^(AFHTTPRequestOperation *operation, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">        <span class="built_in">UIAlertView</span> *alert = [[<span class="built_in">UIAlertView</span> alloc]initWithTitle:<span class="string">@"请求错误"</span> message:<span class="string">@"请检查网络，重新加载!"</span> delegate:<span class="keyword">self</span> cancelButtonTitle:<span class="string">@"OK"</span> otherButtonTitles: <span class="literal">nil</span>,<span class="literal">nil</span>];</span><br><span class="line">        [alert show];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">上面是PNChart的调用画线，不阻塞主线程，当页面数据请求完毕时绘制，但是每次进入页面都会绘制，所以才去如下方法清空并重新绘制：</span><br><span class="line">-(<span class="keyword">void</span>) viewWillAppear:(<span class="built_in">BOOL</span>)animated&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">UIView</span> *view <span class="keyword">in</span> <span class="keyword">self</span>.scrollView.subviews)&#123;</span><br><span class="line">        [view removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">self</span>.acitvityIndex1=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">self</span>.acitvityIndex2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">self</span>.acitvityIndex3=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">self</span>.acitvityIndex4=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">self</span>.acitvityIndex5=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">self</span>.telIndex1=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">self</span>.telIndex2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">self</span>.telIndex3=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">self</span>.telIndex4=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">self</span>.telIndex5=<span class="number">0</span>;</span><br><span class="line">    [<span class="keyword">self</span>  setUpUI];</span><br><span class="line">    [<span class="keyword">self</span>  DateForIn];</span><br><span class="line">    [<span class="keyword">self</span>  getDataForActivity];</span><br><span class="line">    [<span class="keyword">self</span>  getDataForTel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">刷新当前行：</span><br><span class="line">[_tableView reloadRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationAutomatic</span>];</span><br><span class="line"></span><br><span class="line">给<span class="built_in">UItableview</span>添加动画：</span><br><span class="line">	</span><br><span class="line">	-(<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView willDisplayCell:(<span class="built_in">UITableViewCell</span> *)cell forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</span><br><span class="line">	<span class="comment">// 1. 配置CATransform3D的内容</span></span><br><span class="line">	<span class="built_in">CATransform3D</span> transform;</span><br><span class="line">	transform = <span class="built_in">CATransform3DMakeRotation</span>( (<span class="number">90.0</span>*M_PI)/<span class="number">180</span>, <span class="number">0.0</span>, <span class="number">0.7</span>, <span class="number">0.4</span>);</span><br><span class="line">	transform.m34 = <span class="number">1.0</span>/ <span class="number">-600</span>;</span><br><span class="line">	<span class="comment">// 2. 定义cell的初始状态</span></span><br><span class="line">	cell.layer.shadowColor = [[<span class="built_in">UIColor</span> blackColor]<span class="built_in">CGColor</span>];</span><br><span class="line">	cell.layer.shadowOffset = <span class="built_in">CGSizeMake</span>(<span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">	cell.alpha = <span class="number">0</span>;</span><br><span class="line">	cell.layer.transform = transform;</span><br><span class="line">	cell.layer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0.5</span>);</span><br><span class="line">	<span class="comment">// 3. 定义cell的最终状态，并提交动画</span></span><br><span class="line">	[<span class="built_in">UIView</span> beginAnimations:<span class="string">@"transform"</span> context:<span class="literal">NULL</span>];</span><br><span class="line">	[<span class="built_in">UIView</span> setAnimationDuration:<span class="number">0.5</span>];</span><br><span class="line">	cell.layer.transform = <span class="built_in">CATransform3DIdentity</span>;</span><br><span class="line">	cell.alpha = <span class="number">1</span>;</span><br><span class="line">	cell.layer.shadowOffset = <span class="built_in">CGSizeMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	cell.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, cell.frame.origin.y, cell.frame.size.width, cell.frame.size.height);</span><br><span class="line">	[<span class="built_in">UIView</span> commitAnimations];</span><br><span class="line">	&#125;</span><br><span class="line">第一步：使用<span class="built_in">CATransform3D</span>在Y和Z轴上做旋转设置。</span><br><span class="line">第二步：定义cell的初始状态，添加了一些阴影，并将第一步中的transform设置给cell中layer的transform matrix。然后将anchor设置为<span class="number">0.0</span>, <span class="number">0.5</span>，也就是说让cell围绕着左边进行旋转。</span><br><span class="line">第三步：通过动画，将cell设置为原始状态。此处利用了<span class="built_in">UIView</span>的beginAnimations:context方法来更新cell中layer的值。当然还有别的方法来执行动画，不过这种方法比较简单，我们可以设置持续时间。代码里面将transform设置为<span class="built_in">CATransform3DIdentity</span>。</span><br><span class="line">这样通过第二步和第三步的状态就能够引导动画，以此完成最终效果。</span><br></pre></td></tr></table></figure>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
	
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
			
			
		
	
		
	
		
	
		
			
			
			
		
	
		
	
	
	
		<li class="prev"><a href="/2016/06/12/UIView简介和常用方法/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/2016/05/25/自定义UINavigationController/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  &copy; 2016 John Doe
  
      with help from <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-wixo/">Wixo</a>.    
</p> </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tableofcontents.min.js"></script>
<script src="/js/tocgenerator.min.js"></script>
<script src="/js/main.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
